<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.111.3"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon_next.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon_next.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/favicon_next.png><meta itemprop=name content="ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"><meta itemprop=description content="ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zzzicode.github.io/imgs/avatar.png"><meta itemprop=keywords content="k8s"><meta property="og:type" content="article"><meta property="og:title" content="ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"><meta property="og:description" content="ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"><meta property="og:image" content="/imgs/avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zzzicode.github.io/post/%E4%BD%BF%E7%94%A8kubeadm%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/"><meta property="og:site_name" content="zzziçš„å°ç«™"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="zzzi"><meta property="article:published_time" content="2023-06-30 14:58:50 +0800 CST"><meta property="article:modified_time" content="2023-06-30 14:58:50 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.4b7f3d9c4ef8db1505229a7dcd2c4e3ab17cd4960dd8a78b503c013770ad56a6.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ æˆ‘å¯æ˜¯æœ‰åº•çº¿çš„å“Ÿ ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"math":{"js":{"file":"es5/tex-mml-chtml.js","name":"mathjax","version":"3.2.0"},"render":"mathjax"},"path":"%E4%BD%BF%E7%94%A8kubeadm%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4","permalink":"https://zzzicode.github.io/post/%E4%BD%BF%E7%94%A8kubeadm%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/","title":"ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤ - zzziçš„å°ç«™</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>zzziçš„å°ç«™</h1><i class=logo-line></i></a></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>å…³äº</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>å½’æ¡£
<span class=badge>228</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>æœç´¢</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=æœç´¢... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>æ–‡ç« ç›®å½•</li><li class=sidebar-nav-overview>ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#kubeadmæ–¹å¼æ­å»ºk8sé›†ç¾¤>Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤</a></li><li><a href=#å®‰è£…è¦æ±‚>å®‰è£…è¦æ±‚</a></li><li><a href=#å‡†å¤‡ç¯å¢ƒ>å‡†å¤‡ç¯å¢ƒ</a></li><li><a href=#å®‰è£…>å®‰è£…</a><ul><li><a href=#å®‰è£…docker>å®‰è£…Docker</a></li><li><a href=#æ·»åŠ kubernetesè½¯ä»¶æº>æ·»åŠ kubernetesè½¯ä»¶æº</a></li><li><a href=#å®‰è£…kubeadmkubeletå’Œkubectl>å®‰è£…kubeadmï¼Œkubeletå’Œkubectl</a></li></ul></li><li><a href=#éƒ¨ç½²kubernetes-mastermasterèŠ‚ç‚¹>éƒ¨ç½²Kubernetes Masterã€masterèŠ‚ç‚¹ã€‘</a></li><li><a href=#åŠ å…¥kubernetes-nodenodeèŠ‚ç‚¹>åŠ å…¥Kubernetes Nodeã€nodeèŠ‚ç‚¹ã€‘</a></li><li><a href=#éƒ¨ç½²cniç½‘ç»œæ’ä»¶>éƒ¨ç½²CNIç½‘ç»œæ’ä»¶</a></li><li><a href=#æµ‹è¯•kubernetesé›†ç¾¤>æµ‹è¯•kubernetesé›†ç¾¤</a></li><li><a href=#é”™è¯¯æ±‡æ€»>é”™è¯¯æ±‡æ€»</a><ul><li><a href=#é”™è¯¯ä¸€>é”™è¯¯ä¸€</a></li><li><a href=#é”™è¯¯äºŒ>é”™è¯¯äºŒ</a></li><li><a href=#é”™è¯¯ä¸‰>é”™è¯¯ä¸‰</a></li><li><a href=#é”™è¯¯å››>é”™è¯¯å››</a></li><li><a href=#é”™è¯¯äº”>é”™è¯¯äº”</a></li><li><a href=#é”™è¯¯å…­>é”™è¯¯å…­</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=zzzi src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.png><p class=site-author-name itemprop=name>zzzi</p><div class=site-description itemprop=description>make_tuple("å·¥ä½œ","è®ºæ–‡")</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>228</span>
<span class=site-state-item-name>æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>5</span>
<span class=site-state-item-name>åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>54</span>
<span class=site-state-item-name>æ ‡ç­¾</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zzziCode title="Github â†’ https://github.com/zzziCode" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=å…±äº«çŸ¥è¯†><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=å…±äº«çŸ¥è¯†></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
å‹æƒ…é“¾æ¥</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>å‡¡æ¢¦æ˜Ÿå°˜</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=æ·±æµ…æ¨¡å¼åˆ‡æ¢><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=è¿”å›é¡¶éƒ¨><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zzzicode.github.io/post/%E4%BD%BF%E7%94%A8kubeadm%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.png"><meta itemprop=name content="zzzi"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="zzzi"><meta itemprop=description content="make_tuple(&#34;å·¥ä½œ&#34;,&#34;è®ºæ–‡&#34;)"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"><meta itemprop=description content="ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤"></span><header class=post-header><h1 class=post-title itemprop="name headline">ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title=å‘è¡¨äº>å‘è¡¨äºï¼š</span>
<time title="åˆ›å»ºæ—¶é—´ï¼š2023-06-30 14:58:50 +0800 CST" itemprop="dateCreated datePublished" datetime="2023-06-30 14:58:50 +0800 CST">2023-06-30</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text title=åˆ†ç±»äº>åˆ†ç±»äºï¼š</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0 itemprop=url rel=index><span itemprop=name>å­¦ä¹ ç¬”è®°</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=å­—æ•°><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>å­—æ•°ï¼š</span>
<span>3590</span></span>
<span class=post-meta-item title=é˜…è¯»><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>é˜…è¯»ï¼š&ap;</span>
<span>8åˆ†é’Ÿ</span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><blockquote><p>ğŸ˜„ä½¿ç”¨kubeadmæ­å»ºk8sé›†ç¾¤</p></blockquote><p>ä½¿ç”¨kubeadmå·¥å…·æ­å»ºk8sé›†ç¾¤ï¼Œå±è”½æ­å»ºé›†ç¾¤æ—¶çš„ä¸€äº›ç»†èŠ‚ï¼Œä½¿å¾—æ­å»ºé›†ç¾¤å˜å¾—ç®€å•</p><h1 id=ä½¿ç”¨kubeadmæ–¹å¼æ­å»ºk8sé›†ç¾¤>ä½¿ç”¨kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤
<a class=header-anchor href=#%e4%bd%bf%e7%94%a8kubeadm%e6%96%b9%e5%bc%8f%e6%90%ad%e5%bb%bak8s%e9%9b%86%e7%be%a4></a></h1><p>kubeadmæ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²kubernetesé›†ç¾¤çš„å·¥å…·ã€‚</p><p>è¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ªkubernetesé›†ç¾¤çš„éƒ¨ç½²ï¼š</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºä¸€ä¸ª Master èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span>kubeadm init
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°†ä¸€ä¸ª Node èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­</span>
</span></span><span style=display:flex><span>kubeadm join &lt;MasterèŠ‚ç‚¹çš„IPå’Œç«¯å£ &gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=kubeadmæ–¹å¼æ­å»ºk8sé›†ç¾¤>Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤
<a class=header-anchor href=#kubeadm%e6%96%b9%e5%bc%8f%e6%90%ad%e5%bb%bak8s%e9%9b%86%e7%be%a4></a></h2><p>ä½¿ç”¨kubeadmæ–¹å¼æ­å»ºK8sé›†ç¾¤ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥</p><ul><li>å‡†å¤‡ä¸‰å°è™šæ‹Ÿæœºï¼ŒåŒæ—¶å®‰è£…æ“ä½œç³»ç»ŸCentOS 7.x</li><li>å¯¹ä¸‰ä¸ªå®‰è£…ä¹‹åçš„æ“ä½œç³»ç»Ÿè¿›è¡Œåˆå§‹åŒ–æ“ä½œ</li><li>åœ¨ä¸‰ä¸ªèŠ‚ç‚¹å®‰è£… docker kubelet kubeadm kubectl</li><li>åœ¨masterèŠ‚ç‚¹æ‰§è¡Œkubeadm initå‘½ä»¤åˆå§‹åŒ–</li><li>åœ¨nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œ kubeadm joinå‘½ä»¤ï¼ŒæŠŠnodeèŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰é›†ç¾¤</li><li>é…ç½®CNIç½‘ç»œæ’ä»¶ï¼Œç”¨äºèŠ‚ç‚¹ä¹‹é—´çš„è¿é€šã€å¤±è´¥äº†å¯ä»¥å¤šè¯•å‡ æ¬¡ã€‘</li><li>é€šè¿‡æ‹‰å–ä¸€ä¸ªnginxè¿›è¡Œæµ‹è¯•ï¼Œèƒ½å¦è¿›è¡Œå¤–ç½‘æµ‹è¯•</li></ul><h2 id=å®‰è£…è¦æ±‚>å®‰è£…è¦æ±‚
<a class=header-anchor href=#%e5%ae%89%e8%a3%85%e8%a6%81%e6%b1%82></a></h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œéƒ¨ç½²Kubernetesé›†ç¾¤æœºå™¨éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li>ä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»Ÿ CentOS7.x-86_x64</li><li>ç¡¬ä»¶é…ç½®ï¼š2GBæˆ–æ›´å¤šRAMï¼Œ2ä¸ªCPUæˆ–æ›´å¤šCPUï¼Œç¡¬ç›˜30GBæˆ–æ›´å¤šã€æ³¨æ„masteréœ€è¦ä¸¤æ ¸ã€‘</li><li>å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒï¼Œå¦‚æœæœåŠ¡å™¨ä¸èƒ½ä¸Šç½‘ï¼Œéœ€è¦æå‰ä¸‹è½½é•œåƒå¹¶å¯¼å…¥èŠ‚ç‚¹</li><li>ç¦æ­¢swapåˆ†åŒº</li></ul><h2 id=å‡†å¤‡ç¯å¢ƒ>å‡†å¤‡ç¯å¢ƒ
<a class=header-anchor href=#%e5%87%86%e5%a4%87%e7%8e%af%e5%a2%83></a></h2><table><thead><tr><th>è§’è‰²</th><th>IP</th></tr></thead><tbody><tr><td>master</td><td>192.168.177.130</td></tr><tr><td>node1</td><td>192.168.177.131</td></tr><tr><td>node2</td><td>192.168.177.132</td></tr></tbody></table><p>ç„¶åå¼€å§‹åœ¨æ¯å°æœºå™¨ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…³é—­é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­selinux</span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ°¸ä¹…å…³é—­</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#39;s/enforcing/disabled/&#39;</span> /etc/selinux/config  
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸´æ—¶å…³é—­</span>
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­swap</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸´æ—¶</span>
</span></span><span style=display:flex><span>swapoff -a 
</span></span><span style=display:flex><span><span style=color:#75715e># æ°¸ä¹…å…³é—­</span>
</span></span><span style=display:flex><span>sed -ri <span style=color:#e6db74>&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ ¹æ®è§„åˆ’è®¾ç½®ä¸»æœºåã€masterèŠ‚ç‚¹ä¸Šæ“ä½œã€‘</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname k8smaster
</span></span><span style=display:flex><span><span style=color:#75715e># æ ¹æ®è§„åˆ’è®¾ç½®ä¸»æœºåã€node1èŠ‚ç‚¹æ“ä½œã€‘</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname k8snode1
</span></span><span style=display:flex><span><span style=color:#75715e># æ ¹æ®è§„åˆ’è®¾ç½®ä¸»æœºåã€node2èŠ‚ç‚¹æ“ä½œã€‘</span>
</span></span><span style=display:flex><span>hostnamectl set-hostname k8snode2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åœ¨masteræ·»åŠ hosts</span>
</span></span><span style=display:flex><span>cat &gt;&gt; /etc/hosts <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>192.168.177.130 k8smaster
</span></span></span><span style=display:flex><span><span style=color:#e6db74>192.168.177.131 k8snode1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>192.168.177.132 k8snode2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾</span>
</span></span><span style=display:flex><span>cat &gt; /etc/sysctl.d/k8s.conf <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæ•ˆ</span>
</span></span><span style=display:flex><span>sysctl --system  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ—¶é—´åŒæ­¥</span>
</span></span><span style=display:flex><span>yum install ntpdate -y
</span></span><span style=display:flex><span>ntpdate time.windows.com
</span></span></code></pre></td></tr></table></div></div><h2 id=å®‰è£…>å®‰è£…
<a class=header-anchor href=#%e5%ae%89%e8%a3%85></a></h2><p>æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Docker/kubeadm/kubelet ï¼ŒKubernetesé»˜è®¤CRIï¼ˆå®¹å™¨è¿è¡Œæ—¶ï¼‰ä¸ºDockerï¼Œå› æ­¤å…ˆå®‰è£…Docker</p><h3 id=å®‰è£…docker>å®‰è£…Docker
<a class=header-anchor href=#%e5%ae%89%e8%a3%85docker></a></h3><p>é¦–å…ˆé…ç½®ä¸€ä¸‹Dockerçš„é˜¿é‡Œyumæº</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt;/etc/yum.repos.d/docker.repo<span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[docker-ce-edge]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Docker CE Edge - \$basearch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\$basearch/edge
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åyumæ–¹å¼å®‰è£…docker</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># yumå®‰è£…</span>
</span></span><span style=display:flex><span>yum -y install docker-ce
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹dockerç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>docker --version  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨docker</span>
</span></span><span style=display:flex><span>systemctl enable docker
</span></span><span style=display:flex><span>systemctl start docker
</span></span></code></pre></td></tr></table></div></div><p>é…ç½®dockerçš„é•œåƒæº</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt;&gt; /etc/docker/daemon.json <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;registry-mirrors&#34;: [&#34;https://b9pmyelo.mirror.aliyuncs.com&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åé‡å¯docker</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl restart docker
</span></span></code></pre></td></tr></table></div></div><h3 id=æ·»åŠ kubernetesè½¯ä»¶æº>æ·»åŠ kubernetesè½¯ä»¶æº
<a class=header-anchor href=#%e6%b7%bb%e5%8a%a0kubernetes%e8%bd%af%e4%bb%b6%e6%ba%90></a></h3><p>ç„¶åæˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸€ä¸‹yumçš„k8sè½¯ä»¶æº</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt; /etc/yum.repos.d/kubernetes.repo <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>repo_gpgcheck=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å®‰è£…kubeadmkubeletå’Œkubectl>å®‰è£…kubeadmï¼Œkubeletå’Œkubectl
<a class=header-anchor href=#%e5%ae%89%e8%a3%85kubeadmkubelet%e5%92%8ckubectl></a></h3><p>ç”±äºç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œè¿™é‡ŒæŒ‡å®šç‰ˆæœ¬å·éƒ¨ç½²ï¼š</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…kubeletã€kubeadmã€kubectlï¼ŒåŒæ—¶æŒ‡å®šç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0
</span></span><span style=display:flex><span><span style=color:#75715e># è®¾ç½®å¼€æœºå¯åŠ¨</span>
</span></span><span style=display:flex><span>systemctl enable kubelet
</span></span></code></pre></td></tr></table></div></div><h2 id=éƒ¨ç½²kubernetes-mastermasterèŠ‚ç‚¹>éƒ¨ç½²Kubernetes Masterã€masterèŠ‚ç‚¹ã€‘
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2kubernetes-mastermaster%e8%8a%82%e7%82%b9></a></h2><p>åœ¨ 192.168.177.130 æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯masterèŠ‚ç‚¹</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm init --apiserver-advertise-address<span style=color:#f92672>=</span>192.168.177.130 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.0 --service-cidr<span style=color:#f92672>=</span>10.96.0.0/12  --pod-network-cidr<span style=color:#f92672>=</span>10.244.0.0/16
</span></span></code></pre></td></tr></table></div></div><p>ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€k8s.gcr.ioå›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€ï¼Œã€æ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºåå°å…¶å®å·²ç»åœ¨æ‹‰å–é•œåƒäº†ã€‘ï¼Œæˆ‘ä»¬ docker images å‘½ä»¤å³å¯æŸ¥çœ‹å·²ç»æ‹‰å–çš„é•œåƒ</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451827.png alt=image-20200929094302491></p><p>å½“æˆ‘ä»¬å‡ºç°ä¸‹é¢çš„æƒ…å†µæ—¶ï¼Œè¡¨ç¤ºkubernetesçš„é•œåƒå·²ç»å®‰è£…æˆåŠŸ</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451829.png alt=image-20200929094620145></p><p>ä½¿ç”¨kubectlå·¥å…· ã€masterèŠ‚ç‚¹æ“ä½œã€‘</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p $HOME/.kube
</span></span><span style=display:flex><span>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style=display:flex><span>sudo chown <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>id -g<span style=color:#66d9ef>)</span> $HOME/.kube/config
</span></span></code></pre></td></tr></table></div></div><p>æ‰§è¡Œå®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼ŒæŸ¥çœ‹æˆ‘ä»¬æ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></td></tr></table></div></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451830.png alt=image-20200929094933142></p><p>èƒ½å¤Ÿçœ‹åˆ°ï¼Œç›®å‰æœ‰ä¸€ä¸ªmasterèŠ‚ç‚¹å·²ç»è¿è¡Œäº†ï¼Œä½†æ˜¯è¿˜å¤„äºæœªå‡†å¤‡çŠ¶æ€</p><p>ä¸‹é¢æˆ‘ä»¬è¿˜éœ€è¦åœ¨NodeèŠ‚ç‚¹æ‰§è¡Œå…¶å®ƒçš„å‘½ä»¤ï¼Œå°†node1å’Œnode2åŠ å…¥åˆ°æˆ‘ä»¬çš„masterèŠ‚ç‚¹ä¸Š</p><h2 id=åŠ å…¥kubernetes-nodenodeèŠ‚ç‚¹>åŠ å…¥Kubernetes Nodeã€nodeèŠ‚ç‚¹ã€‘
<a class=header-anchor href=#%e5%8a%a0%e5%85%a5kubernetes-nodenode%e8%8a%82%e7%82%b9></a></h2><p>ä¸‹é¢æˆ‘ä»¬éœ€è¦åˆ° node1 å’Œ node2æœåŠ¡å™¨ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç å‘é›†ç¾¤æ·»åŠ æ–°èŠ‚ç‚¹</p><p>æ‰§è¡Œåœ¨kubeadm initè¾“å‡ºçš„kubeadm joinå‘½ä»¤ï¼š</p><blockquote><p>æ³¨æ„ï¼Œä»¥ä¸‹çš„å‘½ä»¤æ˜¯åœ¨masteråˆå§‹åŒ–å®Œæˆåï¼Œæ¯ä¸ªäººçš„éƒ½ä¸ä¸€æ ·ï¼ï¼ï¼éœ€è¦å¤åˆ¶è‡ªå·±ç”Ÿæˆçš„</p></blockquote><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join 192.168.177.130:6443 --token 8j6ui9.gyr4i156u30y80xf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:eda1380256a62d8733f4bddf926f148e57cf9d1a3a58fb45dd6e80768af5a500
</span></span></code></pre></td></tr></table></div></div><p>é»˜è®¤tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶ï¼Œå½“è¿‡æœŸä¹‹åï¼Œè¯¥tokenå°±ä¸å¯ç”¨äº†ã€‚è¿™æ—¶å°±éœ€è¦é‡æ–°åˆ›å»ºtokenï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm token create --print-join-command
</span></span></code></pre></td></tr></table></div></div><p>å½“æˆ‘ä»¬æŠŠä¸¤ä¸ªèŠ‚ç‚¹éƒ½åŠ å…¥è¿›æ¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥å»MasterèŠ‚ç‚¹ æ‰§è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹æƒ…å†µ</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get node
</span></span></code></pre></td></tr></table></div></div><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451831.png alt=image-20201113165358663></p><h2 id=éƒ¨ç½²cniç½‘ç»œæ’ä»¶>éƒ¨ç½²CNIç½‘ç»œæ’ä»¶
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2cni%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6></a></h2><p>ä¸Šé¢çš„çŠ¶æ€è¿˜æ˜¯NotReadyï¼Œä¸‹é¢æˆ‘ä»¬éœ€è¦ç½‘ç»œæ’ä»¶ï¼Œæ¥è¿›è¡Œè”ç½‘è®¿é—®</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½ç½‘ç»œæ’ä»¶é…ç½®</span>
</span></span><span style=display:flex><span>wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span></code></pre></td></tr></table></div></div><p>é»˜è®¤é•œåƒåœ°å€æ— æ³•è®¿é—®ï¼Œsedå‘½ä»¤ä¿®æ”¹ä¸ºdocker hubé•œåƒä»“åº“ã€‚</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ·»åŠ </span>
</span></span><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##â‘ é¦–å…ˆä¸‹è½½v0.13.1-rc2-amd64 é•œåƒ</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##å‚è€ƒåšå®¢ï¼šhttps://www.cnblogs.com/pyxuexi/p/14288591.html</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##â‘¡ å¯¼å…¥é•œåƒï¼Œå‘½ä»¤ï¼Œï¼Œç‰¹åˆ«æç¤ºï¼Œ3ä¸ªæœºå™¨éƒ½éœ€è¦å¯¼å…¥ï¼Œ3ä¸ªæœºå™¨éƒ½éœ€è¦å¯¼å…¥ï¼Œ3ä¸ªæœºå™¨éƒ½éœ€è¦å¯¼å…¥ï¼Œ3ä¸ªæœºå™¨éƒ½éœ€è¦å¯¼å…¥ï¼Œé‡è¦çš„äº‹æƒ…è¯´3éã€‚ä¸ç„¶æŠ±é”™ã€‚å¦‚æœæ²¡æœ‰æ“ä½œï¼ŒæŠ¥é”™åï¼Œéœ€è¦åˆ é™¤èŠ‚ç‚¹ï¼Œé‡ç½®ï¼Œåœ¨å¯¼å…¥é•œåƒï¼Œé‡æ–°åŠ å…¥æ‰è¡Œã€‚æœ¬åœ°å°±æ˜¯è¿™æ ·æ“ä½œæˆåŠŸçš„ï¼</span>
</span></span><span style=display:flex><span>docker load &lt; flanneld-v0.13.1-rc2-amd64.docker
</span></span><span style=display:flex><span><span style=color:#75715e>#####ä¸‹è½½æœ¬åœ°ï¼Œæ›¿æ¢å°†image: quay.io/coreos/flannel:v0.13.1-rc2 æ›¿æ¢ä¸º image: quay.io/coreos/flannel:v0.13.1-rc2-amd64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹çŠ¶æ€ ã€kube-systemæ˜¯k8sä¸­çš„æœ€å°å•å…ƒã€‘</span>
</span></span><span style=display:flex><span>kubectl get pods -n kube-system
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œåçš„ç»“æœ</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451832.png alt=image-20201113165929510></p><p>è¿è¡Œå®Œæˆåï¼Œæˆ‘ä»¬æŸ¥çœ‹çŠ¶æ€å¯ä»¥å‘ç°ï¼Œå·²ç»å˜æˆäº†ReadyçŠ¶æ€äº†</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451833.png alt=image-20201113194557147></p><p>å¦‚æœä¸Šè¿°æ“ä½œå®Œæˆåï¼Œè¿˜å­˜åœ¨æŸä¸ªèŠ‚ç‚¹å¤„äºNotReadyçŠ¶æ€ï¼Œå¯ä»¥åœ¨Masterå°†è¯¥èŠ‚ç‚¹åˆ é™¤</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># masterèŠ‚ç‚¹å°†è¯¥èŠ‚ç‚¹åˆ é™¤</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##20210223 yan æŸ¥é˜…èµ„æ–™æ·»åŠ ###kubectl drain k8snode1 --delete-local-data --force --ignore-daemonsets</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl delete node k8snode1
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e># ç„¶ååˆ°k8snode1èŠ‚ç‚¹è¿›è¡Œé‡ç½®</span>
</span></span><span style=display:flex><span> kubeadm reset
</span></span><span style=display:flex><span><span style=color:#75715e># é‡ç½®å®Œååœ¨åŠ å…¥</span>
</span></span><span style=display:flex><span>kubeadm join 192.168.177.130:6443 --token 8j6ui9.gyr4i156u30y80xf     --discovery-token-ca-cert-hash sha256:eda1380256a62d8733f4bddf926f148e57cf9d1a3a58fb45dd6e80768af5a500
</span></span></code></pre></td></tr></table></div></div><h2 id=æµ‹è¯•kubernetesé›†ç¾¤>æµ‹è¯•kubernetesé›†ç¾¤
<a class=header-anchor href=#%e6%b5%8b%e8%af%95kubernetes%e9%9b%86%e7%be%a4></a></h2><p>æˆ‘ä»¬éƒ½çŸ¥é“K8Sæ˜¯å®¹å™¨åŒ–æŠ€æœ¯ï¼Œå®ƒå¯ä»¥è”ç½‘å»ä¸‹è½½é•œåƒï¼Œç”¨å®¹å™¨çš„æ–¹å¼è¿›è¡Œå¯åŠ¨</p><p>åœ¨Kubernetesé›†ç¾¤ä¸­åˆ›å»ºä¸€ä¸ªpodï¼ŒéªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½nginx ã€ä¼šè”ç½‘æ‹‰å–nginxé•œåƒã€‘</span>
</span></span><span style=display:flex><span>kubectl create deployment nginx --image<span style=color:#f92672>=</span>nginx
</span></span><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹çŠ¶æ€</span>
</span></span><span style=display:flex><span>kubectl get pod
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæˆ‘ä»¬å‡ºç°RunningçŠ¶æ€çš„æ—¶å€™ï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸè¿è¡Œäº†</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451834.png alt=image-20201113203537028></p><p>ä¸‹é¢æˆ‘ä»¬å°±éœ€è¦å°†ç«¯å£æš´éœ²å‡ºå»ï¼Œè®©å…¶å®ƒå¤–ç•Œèƒ½å¤Ÿè®¿é—®</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æš´éœ²ç«¯å£</span>
</span></span><span style=display:flex><span>kubectl expose deployment nginx --port<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span> --type<span style=color:#f92672>=</span>NodePort
</span></span><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹ä¸€ä¸‹å¯¹å¤–çš„ç«¯å£</span>
</span></span><span style=display:flex><span>kubectl get pod,svc
</span></span></code></pre></td></tr></table></div></div><p>èƒ½å¤Ÿçœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæš´éœ²äº† 80ç«¯å£ åˆ° 30529ä¸Š</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451835.png alt=image-20201113203840915></p><p>æˆ‘ä»¬åˆ°æˆ‘ä»¬çš„å®¿ä¸»æœºæµè§ˆå™¨ä¸Šï¼Œè®¿é—®å¦‚ä¸‹åœ°å€</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>http://192.168.177.130:30529/
</span></span></code></pre></td></tr></table></div></div><p>å‘ç°æˆ‘ä»¬çš„nginxå·²ç»æˆåŠŸå¯åŠ¨äº†</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451836.png alt=image-20201113204056851></p><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±æ­å»ºäº†ä¸€ä¸ªå•masterçš„k8sé›†ç¾¤</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202306301451837.png alt=image-20201113204158884></p><h2 id=é”™è¯¯æ±‡æ€»>é”™è¯¯æ±‡æ€»
<a class=header-anchor href=#%e9%94%99%e8%af%af%e6%b1%87%e6%80%bb></a></h2><h3 id=é”™è¯¯ä¸€>é”™è¯¯ä¸€
<a class=header-anchor href=#%e9%94%99%e8%af%af%e4%b8%80></a></h3><p>åœ¨æ‰§è¡ŒKubernetes initæ–¹æ³•çš„æ—¶å€™ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>error execution phase preflight: <span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> Some fatal errors occurred:
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>ERROR NumCPU<span style=color:#f92672>]</span>: the number of available CPUs <span style=color:#ae81ff>1</span> is less than the required <span style=color:#ae81ff>2</span>
</span></span></code></pre></td></tr></table></div></div><p>æ˜¯å› ä¸ºVMwareè®¾ç½®çš„æ ¸æ•°ä¸º1ï¼Œè€ŒK8Séœ€è¦çš„æœ€ä½æ ¸æ•°åº”è¯¥æ˜¯2ï¼Œè°ƒæ•´æ ¸æ•°é‡å¯ç³»ç»Ÿå³å¯</p><h3 id=é”™è¯¯äºŒ>é”™è¯¯äºŒ
<a class=header-anchor href=#%e9%94%99%e8%af%af%e4%ba%8c></a></h3><p>æˆ‘ä»¬åœ¨ç»™node1èŠ‚ç‚¹ä½¿ç”¨ kubernetes joinå‘½ä»¤çš„æ—¶å€™ï¼Œå‡ºç°ä»¥ä¸‹é”™è¯¯</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>error execution phase preflight: <span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> Some fatal errors occurred:
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>ERROR Swap<span style=color:#f92672>]</span>: running with swap on is not supported. Please disable swap
</span></span></code></pre></td></tr></table></div></div><p>é”™è¯¯åŸå› æ˜¯æˆ‘ä»¬éœ€è¦å…³é—­swap</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…³é—­swap</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸´æ—¶</span>
</span></span><span style=display:flex><span>swapoff -a 
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸´æ—¶</span>
</span></span><span style=display:flex><span>sed -ri <span style=color:#e6db74>&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab
</span></span></code></pre></td></tr></table></div></div><h3 id=é”™è¯¯ä¸‰>é”™è¯¯ä¸‰
<a class=header-anchor href=#%e9%94%99%e8%af%af%e4%b8%89></a></h3><p>åœ¨ç»™node1èŠ‚ç‚¹ä½¿ç”¨ kubernetes joinå‘½ä»¤çš„æ—¶å€™ï¼Œå‡ºç°ä»¥ä¸‹é”™è¯¯</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>The HTTP call equal to <span style=color:#e6db74>&#39;curl -sSL http://localhost:10248/healthz&#39;</span> failed with error: Get http://localhost:10248/healthz: dial tcp <span style=color:#f92672>[</span>::1<span style=color:#f92672>]</span>:10248: connect: connection refused
</span></span></code></pre></td></tr></table></div></div><p>è§£å†³æ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦åˆ° master èŠ‚ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ–‡ä»¶å¤¹</span>
</span></span><span style=display:flex><span>mkdir /etc/systemd/system/kubelet.service.d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæ–‡ä»¶</span>
</span></span><span style=display:flex><span>vim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ·»åŠ å¦‚ä¸‹å†…å®¹</span>
</span></span><span style=display:flex><span>Environment<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;KUBELET_SYSTEM_PODS_ARGS=--pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true --fail-swap-on=false&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡ç½®</span>
</span></span><span style=display:flex><span>kubeadm reset
</span></span></code></pre></td></tr></table></div></div><p>ç„¶ååˆ é™¤åˆšåˆšåˆ›å»ºçš„é…ç½®ç›®å½•</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>rm -rf $HOME/.kube
</span></span></code></pre></td></tr></table></div></div><p>ç„¶å åœ¨masteré‡æ–°åˆå§‹åŒ–</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm init --apiserver-advertise-address<span style=color:#f92672>=</span>202.193.57.11 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.0 --service-cidr<span style=color:#f92672>=</span>10.96.0.0/12  --pod-network-cidr<span style=color:#f92672>=</span>10.244.0.0/16
</span></span></code></pre></td></tr></table></div></div><p>åˆå§‹å®Œæˆåï¼Œæˆ‘ä»¬å†åˆ° node1èŠ‚ç‚¹ï¼Œæ‰§è¡Œ kubeadm joinå‘½ä»¤ï¼ŒåŠ å…¥åˆ°master</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join 202.193.57.11:6443 --token c7a7ou.z00fzlb01d76r37s <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:9c3f3cc3f726c6ff8bdff14e46b1a856e3b8a4cbbe30cab185f6c5ee453aeea5
</span></span></code></pre></td></tr></table></div></div><p>æ·»åŠ å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼ŒæŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦æˆåŠŸæ·»åŠ </p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></td></tr></table></div></div><h3 id=é”™è¯¯å››>é”™è¯¯å››
<a class=header-anchor href=#%e9%94%99%e8%af%af%e5%9b%9b></a></h3><p>æˆ‘ä»¬å†æ‰§è¡ŒæŸ¥çœ‹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œ kubectl get nodes ä¼šå‡ºç°é—®é¢˜</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>Unable to connect to the server: x509: certificate signed by unknown authority <span style=color:#f92672>(</span>possibly because of <span style=color:#e6db74>&#34;crypto/rsa: verification error&#34;</span> <span style=color:#66d9ef>while</span> trying to verify candidate authority certificate <span style=color:#e6db74>&#34;kubernetes&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶è¿˜å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¿™äº›é…ç½®</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p $HOME/.kube
</span></span><span style=display:flex><span>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style=display:flex><span>sudo chown <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>id -g<span style=color:#66d9ef>)</span> $HOME/.kube/config
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠé…ç½®æ–‡ä»¶åˆ é™¤ï¼Œç„¶åé‡æ–°æ‰§è¡Œä¸€ä¸‹</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>rm -rf $HOME/.kube
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åå†æ¬¡åˆ›å»ºä¸€ä¸‹å³å¯</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p $HOME/.kube
</span></span><span style=display:flex><span>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style=display:flex><span>sudo chown <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>id -g<span style=color:#66d9ef>)</span> $HOME/.kube/config
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œ kubeadm reset çš„æ—¶å€™ï¼Œæ²¡æœ‰æŠŠ $HOME/.kube ç»™ç§»é™¤æ‰ï¼Œå†æ¬¡åˆ›å»ºæ—¶å°±ä¼šå‡ºç°é—®é¢˜äº†</p><h3 id=é”™è¯¯äº”>é”™è¯¯äº”
<a class=header-anchor href=#%e9%94%99%e8%af%af%e4%ba%94></a></h3><p>å®‰è£…çš„æ—¶å€™ï¼Œå‡ºç°ä»¥ä¸‹é”™è¯¯</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>Another app is currently holding the yum lock; waiting <span style=color:#66d9ef>for</span> it to exit...
</span></span></code></pre></td></tr></table></div></div><p>æ˜¯å› ä¸ºyumä¸Šé”å ç”¨ï¼Œè§£å†³æ–¹æ³•</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>yum -y install docker-ce
</span></span></code></pre></td></tr></table></div></div><h3 id=é”™è¯¯å…­>é”™è¯¯å…­
<a class=header-anchor href=#%e9%94%99%e8%af%af%e5%85%ad></a></h3><p>åœ¨ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼Œæ·»åŠ nodeèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸Šçš„æ—¶å€™</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join 192.168.177.130:6443 --token jkcz0t.3c40t0bqqz5g8wsb  --discovery-token-ca-cert-hash sha256:bc494eeab6b7bac64c0861da16084504626e5a95ba7ede7b9c2dc7571ca4c9e5
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åå‡ºç°äº†è¿™ä¸ªé”™è¯¯</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@k8smaster ~<span style=color:#f92672>]</span><span style=color:#75715e># kubeadm join 192.168.177.130:6443 --token jkcz0t.3c40t0bqqz5g8wsb     --discovery-token-ca-cert-hash sha256:bc494eeab6b7bac64c0861da16084504626e5a95ba7ede7b9c2dc7571ca4c9e5</span>
</span></span><span style=display:flex><span>W1117 06:55:11.220907   <span style=color:#ae81ff>11230</span> join.go:346<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> Running pre-flight checks
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>WARNING IsDockerSystemdCheck<span style=color:#f92672>]</span>: detected <span style=color:#e6db74>&#34;cgroupfs&#34;</span> as the Docker cgroup driver. The recommended driver is <span style=color:#e6db74>&#34;systemd&#34;</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/
</span></span><span style=display:flex><span>error execution phase preflight: <span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> Some fatal errors occurred:
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>ERROR FileContent--proc-sys-net-ipv4-ip_forward<span style=color:#f92672>]</span>: /proc/sys/net/ipv4/ip_forward contents are not set to <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> If you know what you are doing, you can make a check non-fatal with <span style=color:#e6db74>`</span>--ignore-preflight-errors<span style=color:#f92672>=</span>...<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>To see the stack trace of this error execute with --v<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> or higher
</span></span></code></pre></td></tr></table></div></div><p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒLinuxç³»ç»Ÿ<strong>é»˜è®¤æ˜¯ç¦æ­¢æ•°æ®åŒ…è½¬å‘</strong>çš„ã€‚æ‰€è°“<strong>è½¬å‘å³å½“ä¸»æœºæ‹¥æœ‰å¤šäºä¸€å—çš„ç½‘å¡æ—¶ï¼Œå…¶ä¸­ä¸€å—æ”¶åˆ°æ•°æ®åŒ…ï¼Œæ ¹æ®æ•°æ®åŒ…çš„ç›®çš„ipåœ°å€å°†åŒ…å‘å¾€æœ¬æœºå¦ä¸€ç½‘å¡ï¼Œè¯¥ç½‘å¡æ ¹æ®è·¯ç”±è¡¨ç»§ç»­å‘é€æ•°æ®åŒ…</strong>ã€‚è¿™é€šå¸¸å°±æ˜¯è·¯ç”±å™¨æ‰€è¦å®ç°çš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ <strong>/proc/sys/net/ipv4/ip_forward</strong> æ–‡ä»¶çš„å€¼ä¸æ”¯æŒè½¬å‘</p><ul><li>0ï¼šç¦æ­¢</li><li>1ï¼šè½¬å‘</li></ul><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å€¼ä¿®æ”¹æˆ1å³å¯</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>echo â€œ1â€ &gt; /proc/sys/net/ipv4/ip_forward
</span></span></code></pre></td></tr></table></div></div><p>ä¿®æ”¹å®Œæˆåï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤å³å¯</p></div><footer class=post-footer><div class=post-tags><a href=/tags/k8s>k8s</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/1143.%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97/ rel=next title=1143.æœ€é•¿å…¬å…±å­åºåˆ—><i class="fa fa-chevron-left"></i> 1143.æœ€é•¿å…¬å…±å­åºåˆ—</a></div><div class="post-nav-prev post-nav-item"><a href=/post/1.kubernetes%E4%BB%8B%E7%BB%8D/ rel=prev title=1.Kubernetesç®€ä»‹>1.Kubernetesç®€ä»‹
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2023 - 2024</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>zzziæä¾›æŠ€æœ¯æ”¯æŒ</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":false,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zzzicode.github.io/","i18n":{"ds_day":" å¤©å‰","ds_days":" å¤© ","ds_hour":" å°æ—¶å‰","ds_hours":" å°æ—¶ ","ds_just":"åˆšåˆš","ds_min":" åˆ†é’Ÿå‰","ds_mins":" åˆ†é’Ÿ","ds_month":" ä¸ªæœˆå‰","ds_years":" å¹´ ","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","placeholder":"æœç´¢..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":null,"views":null},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"right","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"è¯·æ–‡æ˜å‘è¨€å“Ÿ ãƒ¾(â‰§â–½â‰¦*)o","reaction":true,"reactiontext":["ç‚¹èµ","è¸©ä¸€ä¸‹","å¾—æ„","ä¸å±‘","å°´å°¬","ç¡è§‰"],"reactiontitle":"ä½ è®¤ä¸ºè¿™ç¯‡æ–‡ç« æ€ä¹ˆæ ·ï¼Ÿ","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"å¿«æ¥å‘è¡¨ä½ çš„æ„è§å§ (â‰§âˆ€â‰¦)ã‚","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0e26367f0461fb41ac6f947dc2af3620375dc44aa8945e6c2b1480d342c65d1.js defer></script>
<script type=text/javascript src=/js/math.min.a6ada19a368d85dad9ead2040d86ae561a867fafef89391d1aa2aa5909366509.js defer></script></body></html>