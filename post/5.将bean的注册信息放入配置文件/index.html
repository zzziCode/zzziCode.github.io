<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.111.3"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon_next.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon_next.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/favicon_next.png><meta itemprop=name content="将bean的注册信息放入配置文件"><meta itemprop=description content="将bean的注册信息放入配置文件"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zzzicode.github.io/imgs/avatar.png"><meta itemprop=keywords content="spring,源码"><meta property="og:type" content="article"><meta property="og:title" content="将bean的注册信息放入配置文件"><meta property="og:description" content="将bean的注册信息放入配置文件"><meta property="og:image" content="/imgs/avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zzzicode.github.io/post/5.%E5%B0%86bean%E7%9A%84%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF%E6%94%BE%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"><meta property="og:site_name" content="zzzi的小站"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="zzzi"><meta property="article:published_time" content="2023-11-01 09:21:26 +0800 CST"><meta property="article:modified_time" content="2023-11-01 09:21:26 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.4b7f3d9c4ef8db1505229a7dcd2c4e3ab17cd4960dd8a78b503c013770ad56a6.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"math":{"js":{"file":"es5/tex-mml-chtml.js","name":"mathjax","version":"3.2.0"},"render":"mathjax"},"path":"5.%E5%B0%86bean%E7%9A%84%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF%E6%94%BE%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6","permalink":"https://zzzicode.github.io/post/5.%E5%B0%86bean%E7%9A%84%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF%E6%94%BE%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/","title":"将bean的注册信息放入配置文件"}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>将bean的注册信息放入配置文件 - zzzi的小站</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>zzzi的小站</h1><i class=logo-line></i></a></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>217</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#原因>原因</a></li><li><a href=#思路>思路</a><ul><li><a href=#修改的类>修改的类</a></li><li><a href=#新增的类>新增的类</a><ul><li><a href=#coreio>core.io</a></li><li><a href=#beans>beans</a></li><li><a href=#util>util</a></li></ul></li><li><a href=#bean的创建和获取>bean的创建和获取</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=zzzi src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.png><p class=site-author-name itemprop=name>zzzi</p><div class=site-description itemprop=description>make_tuple("工作","论文")</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>217</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>5</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>46</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zzziCode title="Github → https://github.com/zzziCode" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zzzicode.github.io/post/5.%E5%B0%86bean%E7%9A%84%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF%E6%94%BE%E5%85%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.png"><meta itemprop=name content="zzzi"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="zzzi"><meta itemprop=description content="make_tuple(&#34;工作&#34;,&#34;论文&#34;)"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="将bean的注册信息放入配置文件"><meta itemprop=description content="将bean的注册信息放入配置文件"></span><header class=post-header><h1 class=post-title itemprop="name headline">将bean的注册信息放入配置文件</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title=发表于>发表于：</span>
<time title="创建时间：2023-11-01 09:21:26 +0800 CST" itemprop="dateCreated datePublished" datetime="2023-11-01 09:21:26 +0800 CST">2023-11-01</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text title=分类于>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0 itemprop=url rel=index><span itemprop=name>学习笔记</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span>
<span>5146</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>11分钟</span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><blockquote><p>🍒 将bean的注册信息放入配置文件</p></blockquote><p>之前几节已经实现了将bean的创建交给IOC容器，并且创建和属性填充已经分开，但是bean的定义、注册、属性填充、对象调用都是<strong>手动</strong>在测试方法中实现的，这与真正的spring并不相符，所以本节在之前的基础上将spring中bean的定义，注册，属性填充等都配置到<strong>配置文件</strong>中，然后编写代码读取配置文件中的信息，完成定义，注册，属性填充等操作，使其变得更<strong>像</strong>一个spring框架，详细的代码在
<a href=https://github.com/zzziCode/small-spring.git title=仓库 rel="noopener external nofollow noreferrer" target=_blank class=exturl>仓库
<i class="fa fa-external-link-alt"></i>
</a>中</p><h2 id=原因>原因
<a class=header-anchor href=#%e5%8e%9f%e5%9b%a0></a></h2><p>​ 在之前几节中，我们实现了bean的创建交给IOC容器，并且创建和属性填充分开的效果，但是存在的问题是，不管怎么获取bean对象，在获取之前都需要将bean的注册信息<strong>手动</strong>配置好，然后再获取bean对象，这与真实的spring框架并不相同，正常需要从<strong>配置文件</strong>中获取bean的注册信息，所以本节的目标是为了将手动配置bean的注册信息改成从配置文件中获取。</p><h2 id=思路>思路
<a class=header-anchor href=#%e6%80%9d%e8%b7%af></a></h2><p>​ 为了实现在配置文件中读取bean的注册信息的目的，主要新增了一个资源<strong>加载</strong>和资源<strong>利用</strong>的模块，正常的bean注册和属性填充的功能保持不变。新增的功能分别处于core.io和beans模块中，从原先的在测试方法中手动编写bean的注册信息改成现在的在配置文件中加载，使其更加符合真实spring的情况</p><p>​ 为了实现本节中提到的将bean的注册信息改成从配置文件中读取的目的，主要新增了一个资源<strong>加载</strong>和资源<strong>利用</strong>的模块，正常的bean注册和属性填充的功能保持不变。新增的功能分别处于<code>core.io</code>和<code>beans</code>模块中，从原先的在测试方法中手动编写bean的注册信息改成现在的在配置文件中加载，使其更加符合真实spring的情况</p><p>​ 对于资源加载来说，类的整体结构图如下：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328804.png alt=image-20231101125737113 style=zoom:50%><p>​ 对于资源利用来说，类的整体结构图如下：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328805.png alt=image-20231101125312421 style=zoom:50%><p>通过加入以上两个模块，实现了将bean的注册信息由手动注册改为从配置文件中加载，下面介绍本节中一些<strong>类的变化</strong>：</p><h3 id=修改的类>修改的类
<a class=header-anchor href=#%e4%bf%ae%e6%94%b9%e7%9a%84%e7%b1%bb></a></h3><p>在本项目中，对原有的类进行了部分修改，下面逐个介绍每一个被修改的类，以及修改的意义是什么：</p><ol><li><p><code>BeanFactory</code>：在这个接口中新增一个按照类型获取bean对象的待实现方法，然后在<code>AbstractBeanFactory</code>类中进行了实现，新的类结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328806.png alt=image-20231101103125664></p></li><li><p><code>AbstractBeanFactory</code>：对上面提到的按照类型获取bean对象的方法进行了实现，也就是新增了一个方法，新的类结构为：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328808.png alt=image-20231101103251689 style=zoom:80%></li><li><p><code>BeanDefinitionRegistry</code>：在这个接口中新增了三个待实现的方法，分别是按照名称获取bean的注册信息<code>getBeanDefinition(String beanName)</code>，按照名称判断是否存在某一个bean的注册信息<code>containsBeanDefinition(String beanName)</code>，获取所有已注册的bean的名称<code>getBeanDefinitionNames()</code>，新增方法之后在核心类<code>DefaultListableBeanFactory</code>中对这三个方法进行了实现，新的类结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328809.png alt=image-20231101103646866></p></li><li><p><code>DefaultListableBeanFactory</code>：是项目中的<strong>核心类</strong>，实现了上面的<code>BeanDefinitionRegistry</code>提供的方法，新的类结构为：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328810.png alt=image-20231101104214418 style=zoom:80%></li></ol><p>​ 对上面的几个类和接口进行修改的目的是为了增加程序的健壮性和功能，新增之后对外提供的api更加丰富，并且部分方法的新增是为了服务于其他的功能，部分接口的拓展参照了spring源码，随着项目的完善，这些接口会<u>逐渐发挥作用</u></p><p>​ 上述修改的类几乎对本节中的目标没有大的帮助，因为本节中主要是将bean的注册信息从手动改成由配置文件中自动获取，所以核心在新增的类中，下面介绍这些新增的类做了些什么</p><h3 id=新增的类>新增的类
<a class=header-anchor href=#%e6%96%b0%e5%a2%9e%e7%9a%84%e7%b1%bb></a></h3><p>​ 在本节中，新增了很多类和接口，部分是考虑到后期的项目扩展，部分是本节中的核心，总之新增了这些类之后，可以扩展项目的功能，并且保证项目的健壮性，下面依次介绍每一个新增的类都有什么含义，带来了什么影响</p><p>​ 按照项目的结构安排，本项目中将bean的定义，注册，初始化等操作抽取到配置文件中，也就是说先要读取配置文件中的资源，然后在利用这些资源进行处理，从而实现将配置信息注册到bean容器中，主要分为两个部分，资源的<strong>加载</strong>和资源的<strong>利用</strong>，分别对应到<code>core.io</code>包和<code>beans</code>包，所以先介绍<code>core.io</code>包中的资源加载</p><h4 id=coreio>core.io
<a class=header-anchor href=#coreio></a></h4><ol><li><p><code>Resource</code>：新增的接口，里面就一个方法，用来获取文件的输入流，便于读取文件，得到文件输入流之后，才能获取到里面的资源，这里只是提供了接口，一共有三种读取资源的方式：<strong>ClassPath</strong>、<strong>系统文件</strong>、<strong>云配置文件</strong>，所以这个接口一共有三个实现类。最终的目的是为了得到配置文件的文件输入流。类的结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328811.png alt=image-20231101105724182></p></li><li><p><code>ClassPathResource</code>：第一种加载资源的方式：<strong>ClassPath</strong>，对外提供接口，初始化里面的路径path和classLoader，之后利用classLoader获取到文件输入流，这样就实现了资源的加载，得到了文件的输入流，类的结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328812.png alt=image-20231101110114880></p><blockquote><p>核心代码为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>InputStream is <span style=color:#f92672>=</span> classLoader<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsStream</span><span style=color:#f92672>(</span>path<span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><code>FileSystemResource</code>：第二种加载资源的方式：<strong>系统文件</strong>，对外提供接口，初始化里面的file和path路径，之后利用文件中的接口得到对应配置文件的输入流，类的结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328813.png alt=image-20231101110325882></p><blockquote><p>核心代码为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> FileInputStream<span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>file</span><span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div></blockquote></li><li><p><code>UrlResource</code>：第三种加载资源的方式：<strong>云配置文件</strong>，对外提供接口，初始化里面的url，利用url中的接口获取到配置文件的输入流，类的结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328814.png alt=image-20231101110445639></p><blockquote><p>核心代码为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>URLConnection con <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>url</span><span style=color:#f92672>.</span><span style=color:#a6e22e>openConnection</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> con<span style=color:#f92672>.</span><span style=color:#a6e22e>getInputStream</span><span style=color:#f92672>();</span>
</span></span></code></pre></td></tr></table></div></div></blockquote></li></ol><blockquote><p>以上三种获取资源的方式都是利用了各自提供的接口获取到文件的输入流，获取到输入流之后，就可以一视同仁，将其当成流来处理了</p></blockquote><ol start=5><li><p><code>ResourceLoader</code>：一个接口，提供一个获取资源的接口，在里面调用上述三种加载资源的方式中的一种。按照资源加载的不同方式，资源加载器可以把这些方式集中到统一的类服务下进行处理，外部用户只需要传递资源地址即可，简化使用。类的结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328815.png alt=image-20231101110735641></p></li><li><p><code>DefaultResourceLoader</code>：在这里实现具体的资源加载，内部默认优先使用ClassPath的方式加载配置文件，之后是云配置文件，最后才是系统文件：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328816.png alt=image-20231101110935612 style=zoom:67%></li></ol><p>​ 上面新增的6个类实现了对配置文件的加载，也就是上面描述的第一步，资源的<strong>加载</strong>，简单来说就是将配置文件的输入流通过不同方式得到了，下面就是资源的利用，主要涉及到三个类。接口：<code>BeanDefinitionReader</code>、抽象类：<code>AbstractBeanDefinitionReader</code>、实现类：<code>XmlBeanDefinitionReader</code>，这三部分内容主要是合理清晰的处理了资源读取后的注册 Bean 容器操作。<em>接口管定义，抽象类处理非接口功能外的注册Bean组件填充，最终实现类即可只关心具体的业务实现</em>。形成的整体类图为：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328817.png alt=image-20231101125639720 style=zoom:50%><p>​ 下面详细介绍<code>beans</code>中新增的类</p><h4 id=beans>beans
<a class=header-anchor href=#beans></a></h4><ol><li><p><code>BeanDefinitionReader</code>：接口中一共有<strong>三种</strong>方法，第一种是获取bean的注册信息类<code>BeanDefinitionRegistry</code>，这里面包含bean信息的注册，获取等操作。第二种是获取资源加载器，也就是<strong>core.io</strong>包中的<code>ResourceLoader</code>，第三种就是根据获取到的资源加载资源的定义，类的结构如下：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328818.png alt=image-20231101121138800></p></li><li><p><code>AbstractBeanDefinitionReader</code>：在这个类中主要是实现对资源加载器和注册信息类的<strong>初始化</strong>，为了后面资源信息的利用打基础，后面的实现类只用关注资源的利用即可，类的结构如下：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328819.png alt=image-20231101121354321></p><blockquote><p>主要实现了对两个变量的初始化工作</p></blockquote></li><li><p><code>XmlBeanDefinitionReader</code>：本项目中<strong>最核心</strong>的类，主要实现了对资源的<strong>利用</strong>，资源的加载阶段获取到了配置文件的输入流，然后资源利用阶段就是将配置文件中的信息读取处理，之后按照配置来初始化bean的注册信息，类的结构如下：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328820.png alt=image-20231101121744877></p><p>使用的步骤分为以下几步：</p><ul><li>初始化bean工厂</li><li>将bean工厂交给这个类管理</li><li>指定配置文件的位置</li><li>内部自动利用配置文件中的信息注册bean的信息到工厂中</li><li>外部利用工厂来获取bean，自然就有了bean对象</li></ul><blockquote><p>最核心的就是<code>doLoadBeanDefinitions</code>方法，此方法将配置文件中的信息转换为bean的注册信息，实现了读取配置文件内容的功能，简单来说就是读取文件中信息，以上三个类的类结构图如下所示，这也是本项目中<strong>资源利用</strong>的核心模块：</p></blockquote><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328805.png alt=image-20231101125312421 style=zoom:50%></li><li><p><code>AutowireCapableBeanFactory</code>：新增的接口，为了后期项目的扩展，没有任何内容，后期准备使用这个接口来自动化处理bean工厂的配置</p></li><li><p><code>ConfigurableBeanFactory</code>：新增的接口，里面保存了spring框架中的配置信息，目前只保存了bean的实例化模式，类的结构如下：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328822.png alt=image-20231101104821589></p></li><li><p><code>ConfigurableListableBeanFactory</code>：新增的一个接口，里面提供了一个<code>getBeanDefinition(String beanName)</code>方法</p></li><li><p><code>HierarchicalBeanFactory</code>：新增的接口，后期会在其中提供获取父类的beanFactory的方法</p></li><li><p><code>ListableBeanFactory</code>：新增的接口，提供了两个待实现的方法，分别可以获取bean的类型，获取所有已注册的bean的名称，最终的实现在<code>DefaultListableBeanFactory</code>这个类中，类的结构为：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328823.png alt=image-20231101122430504></p></li></ol><p>​ 以上这些新增的类主要是实现了描述的第二步，资源的利用，将bean的注册信息由手动变成自动，在之前的章节中，测试代码中需要手动将bean的注册信息创建好，本节的目标是将这些注册信息保存到xml文件中，xml文件的例子如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;beans&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;bean</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;userDao&#34;</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;cn.bugstack.springframework.test.bean.UserDao&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;bean</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;userService&#34;</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;cn.bugstack.springframework.test.bean.UserService&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;uId&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;10001&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;userDao&#34;</span> <span style=color:#a6e22e>ref=</span><span style=color:#e6db74>&#34;userDao&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/beans&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>新的测试代码为：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test_xml</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1.初始化 BeanFactory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    DefaultListableBeanFactory beanFactory <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DefaultListableBeanFactory<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. 读取配置文件&amp;注册Bean
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    XmlBeanDefinitionReader reader <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> XmlBeanDefinitionReader<span style=color:#f92672>(</span>beanFactory<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    reader<span style=color:#f92672>.</span><span style=color:#a6e22e>loadBeanDefinitions</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;classpath:spring.xml&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. 获取Bean对象调用方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    UserService userService <span style=color:#f92672>=</span> beanFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;userService&#34;</span><span style=color:#f92672>,</span> UserService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    String result <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>queryUserInfo</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;测试结果：&#34;</span> <span style=color:#f92672>+</span> result<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 重点在7~8行，将bean的注册信息改成从配置文件中获取，而底层的逻辑就是上面这些新增的类实现的</p><h4 id=util>util
<a class=header-anchor href=#util></a></h4><p>这个包中新增了一个类<code>ClassUtils</code>，主要是用来获取默认的类加载器，类的结构如下：</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328824.png alt=image-20231101124651995></p><h3 id=bean的创建和获取>bean的创建和获取
<a class=header-anchor href=#bean%e7%9a%84%e5%88%9b%e5%bb%ba%e5%92%8c%e8%8e%b7%e5%8f%96></a></h3><p>​ 经历上面的扩充，bean的注册信息已经可以从配置文件中获取了，现在bean的创建的步骤首先需要经过读取配置文件的步骤，读取配置文件分为资源的<strong>加载</strong>和<strong>利用</strong>。将bean的注册信息注册到注册表中之后，获取bean的时候会根据注册信息进行bean的实例化和属性填充</p><p>​ 对于整个项目来说，资源的加载和利用只是一个很小的前期准备工作，流程结构如下图所示：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011328825.png alt=image-20231101131726483 style=zoom:50%><p>资源加载和利用结束之后，才是<strong>getBean</strong>的操作，也就是在获取bean的前面进行增加了一个读取配置文件的模块，读取完之后就是之前介绍的正常获取bean的过程，流程图如下：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311030859937.png alt=image-20231103085923756 style=zoom:50%><p>经历上面两个流程之后，就可以实现bean的获取，在第一部分中实现了bean的注册信息从配置文件中读取的效果，对代码进行debug之后，效果如下图：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011551364.png alt=image-20231101155059323 style=zoom:50%><p>可以看出，bean的属性依赖的注册被配置到配置文件中，照样可以完成属性的注册</p><h2 id=总结>总结
<a class=header-anchor href=#%e6%80%bb%e7%bb%93></a></h2><p>​ 本节中实现了bean的注册信息从配置文件中读取的效果，这是bean获取之前的一个步骤，为了实现这个步骤，新增了很多类，总结起来有两个模块，第一个是资源的加载模块，代码集中在<code>core.io</code>包中，实现了得到不同配置文件的输入流的效果，支持ClassPath，系统文件，云配置文件三种类型的配置文件。</p><p>​ 第二个是资源的利用模块，主要是根据第一个模块中得到的输入流来读取配置文件中的信息，将这些信息加载出来注册给bean，相当于一个工具类。代码集中在<code>beans</code>包中，两个模块之间类的利用关系如下图所示：</p><img src=https://zzzi-img-1313100942.cos.ap-beijing.myqcloud.com/img/202311011324511.png alt="图 6-3" style=zoom:70%><p>​ 实现了从配置文件中加载bean的注册信息之后，还对原始的项目进行了<strong>健壮性</strong>的改进，为了后期的扩充打好基础</p><p>​ 主要是以下几个步骤：</p><ol><li>编辑好xml配置文件</li><li>创建beanFactory工厂并将其传入xml的读取器中，这样后期读取到的所有beanDefinition就可以保存到当前这个beanFactory中</li><li>根据传入的配置文件拿到其文件输入流（可以传入文件的资源对象，也可以传递文件的路径，内部自动解析出文件的资源对象）</li><li>根据文件输入流按照层级关系读取beanDefinition</li><li>每读取到一个beanDefinition就将其保存到beanFactory的Map中</li><li>读取完毕之后，和之前一样正常完成bean的实例化即可（使用getBean方法）</li></ol><blockquote><p>主要是将beanDefinition的配置放入了xml配置文件中，然后编写代码将注册工作交给spring自动完成，我们只需要配置好xml文件，启动容器之后就可以直接从容器中拿到实例化后的bean了</p></blockquote></div><footer class=post-footer><div class=post-tags><a href=/tags/spring>spring</a>
<a href=/tags/%e6%ba%90%e7%a0%81>源码</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/6.%E5%BC%95%E5%85%A5applicationcontext%E5%92%8C%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8/ rel=next title=引入ApplicationContext和后置处理器><i class="fa fa-chevron-left"></i> 引入ApplicationContext和后置处理器</a></div><div class="post-nav-prev post-nav-item"><a href=/post/380.%E7%BA%BF%E6%80%A7%E6%97%B6%E9%97%B4%E6%97%B6%E9%97%B4%E6%8F%92%E5%85%A5%E5%88%A0%E9%99%A4%E5%92%8C%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E5%85%83%E7%B4%A0/ rel=prev title=380.线性时间时间插入、删除和获取随机元素>380.线性时间时间插入、删除和获取随机元素
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2023 - 2024</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>zzzi提供技术支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":false,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zzzicode.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":null,"views":null},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"right","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0e26367f0461fb41ac6f947dc2af3620375dc44aa8945e6c2b1480d342c65d1.js defer></script>
<script type=text/javascript src=/js/math.min.a6ada19a368d85dad9ead2040d86ae561a867fafef89391d1aa2aa5909366509.js defer></script></body></html>